export function attachVisualiser(audioEl, canvasId='visualiser'){const canvas=document.getElementById(canvasId);if(!canvas||!audioEl)return;const ctx=canvas.getContext('2d');let w,h;function resize(){w=canvas.width=innerWidth;h=canvas.height=200}resize();addEventListener('resize',resize);const ac=new (window.AudioContext||window.webkitAudioContext)();const src=ac.createMediaElementSource(audioEl);const analyser=ac.createAnalyser();analyser.fftSize=256;src.connect(analyser);analyser.connect(ac.destination);const data=new Uint8Array(analyser.frequencyBinCount);function draw(){analyser.getByteFrequencyData(data);ctx.clearRect(0,0,w,h);for(let i=0;i<data.length;i++){const val=data[i]/255;const x=i*(w/data.length);const bar=h*val;ctx.fillStyle='rgba(122,162,255,.8)';ctx.fillRect(x,h-bar,(w/data.length)-2,bar);}requestAnimationFrame(draw)}audioEl.addEventListener('play',()=>ac.resume());draw();}